<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marka Anketi</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,200;0,300;0,400;0,500;1,300&family=Josefin+Sans:wght@100;200;300;400&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { background:#faf7f2; color:#2a2018; font-family:'DM Sans',sans-serif; min-height:100vh; }

.screen { display:none; }
.screen.active { display:flex; flex-direction:column; min-height:100vh; }

.progress-bar { position:fixed; top:0; left:0; height:3px; background:#8a6a40; transition:width 0.5s ease; z-index:100; }

#intro { min-height:100vh; align-items:center; justify-content:center; text-align:center; padding:60px 24px; position:relative; overflow:hidden; }
#intro::before { content:''; position:absolute; top:-100px; right:-100px; width:500px; height:500px; background:radial-gradient(circle, rgba(180,144,80,0.08) 0%, transparent 60%); pointer-events:none; }
.intro-eyebrow { font-size:0.6rem; letter-spacing:5px; color:#b4906a; text-transform:uppercase; margin-bottom:20px; position:relative; z-index:1; }
#intro h1 { font-size:clamp(2rem,6vw,3.2rem); font-weight:300; color:#2a2018; line-height:1.2; margin-bottom:16px; position:relative; z-index:1; }
#intro p { font-size:0.88rem; color:#9a8a70; line-height:1.9; max-width:400px; font-weight:300; margin:0 auto 32px; position:relative; z-index:1; }
.start-btn { padding:16px 48px; background:#2a2018; color:#faf7f2; border:none; border-radius:100px; font-family:'DM Sans',sans-serif; font-size:0.85rem; cursor:pointer; transition:all 0.3s; position:relative; z-index:1; letter-spacing:2px; }
.start-btn:hover { background:#3d3020; transform:translateY(-2px); }

.q-wrap { flex:1; display:none; flex-direction:column; align-items:center; padding:60px 20px 40px; max-width:600px; margin:0 auto; width:100%; }
.q-wrap.active { display:flex; }
.q-step { font-size:0.55rem; letter-spacing:4px; color:#b4906a; text-transform:uppercase; margin-bottom:12px; }
.q-title { font-size:clamp(1.3rem,4vw,1.8rem); font-weight:300; color:#2a2018; text-align:center; margin-bottom:6px; line-height:1.3; }
.q-hint { font-size:0.78rem; color:#b4906a; font-weight:300; text-align:center; margin-bottom:28px; }

.demo-group { width:100%; margin-bottom:22px; text-align:center; }
.demo-label { font-size:0.65rem; letter-spacing:3px; color:#9a8a70; text-transform:uppercase; margin-bottom:12px; text-align:center; }
.demo-opts { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
.demo-opt { padding:10px 18px; border:1px solid rgba(42,32,24,0.15); border-radius:100px; font-size:0.8rem; color:#7a6a50; cursor:pointer; transition:all 0.2s; background:#fff; }
.demo-opt:hover { border-color:#b4906a; }
.demo-opt.sel { border-color:#8a6a40; background:#fdf8f2; color:#2a2018; font-weight:500; }

.brand-rating-page { width:100%; max-width:500px; }
.brand-logo-box { background:#fff; border-radius:16px; padding:28px 24px 20px; display:flex; flex-direction:column; align-items:center; margin-bottom:24px; box-shadow:0 4px 20px rgba(42,32,24,0.07); border:1px solid rgba(42,32,24,0.06); }
.brand-logo-box .vname { font-family:'Josefin Sans',sans-serif; font-weight:200; font-size:2.2rem; color:#2a2820; letter-spacing:10px; line-height:1; }
.brand-logo-box .vsub { font-family:'Josefin Sans',sans-serif; font-weight:300; font-size:0.7rem; letter-spacing:3px; color:#aaa; margin-top:8px; }

.criteria-list { width:100%; display:flex; flex-direction:column; gap:16px; }
.criterion { background:#fff; border-radius:14px; padding:16px 18px; border:1px solid rgba(42,32,24,0.07); box-shadow:0 2px 10px rgba(42,32,24,0.04); }
.crit-label { font-size:0.82rem; color:#2a2018; font-weight:400; margin-bottom:12px; display:flex; align-items:center; gap:8px; }
.crit-emoji { font-size:1.1rem; }
input.crit-range { width:100%; -webkit-appearance:none; appearance:none; height:3px; background:rgba(42,32,24,0.1); border-radius:2px; outline:none; cursor:pointer; margin-bottom:8px; display:block; }
input.crit-range::-webkit-slider-thumb { -webkit-appearance:none; width:22px; height:22px; border-radius:50%; background:#2a2018; cursor:pointer; box-shadow:0 2px 8px rgba(42,32,24,0.2); transition:transform 0.15s; }
input.crit-range::-webkit-slider-thumb:hover { transform:scale(1.1); }
input.crit-range.untouched::-webkit-slider-thumb { opacity:0; }
.crit-nums { display:flex; justify-content:space-between; }
.crit-num { font-size:0.6rem; color:#ccc; cursor:pointer; transition:all 0.15s; width:20px; text-align:center; padding:3px 0; border-radius:4px; }
.crit-num:hover { color:#8a6a40; }
.crit-num.active { color:#2a2018; font-weight:700; background:#fdf8f2; }
.scale-label { font-size:0.65rem; color:#b4906a; text-align:center; margin-top:6px; min-height:16px; letter-spacing:0.5px; font-style:italic; }

.pick-cards { display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; width:100%; max-width:560px; }
.pick-card { border:1.5px solid rgba(42,32,24,0.12); border-radius:14px; overflow:hidden; cursor:pointer; transition:all 0.2s; background:#fff; }
.pick-card:hover { border-color:#b4906a; transform:translateY(-2px); }
.pick-card.sel { border-color:#8a6a40; box-shadow:0 4px 20px rgba(42,32,24,0.12); }
.pc-visual { aspect-ratio:1/1; width:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:12px; background:#fff; }
.pc-visual .vname { font-family:'Josefin Sans',sans-serif; font-weight:200; font-size:1.3rem; color:#2a2820; letter-spacing:6px; text-align:center; }
.pc-visual .vsub { font-family:'Josefin Sans',sans-serif; font-weight:300; font-size:0.5rem; letter-spacing:2px; color:#aaa; margin-top:6px; text-align:center; }
.pc-none-visual { aspect-ratio:1/1; width:100%; display:flex; align-items:center; justify-content:center; background:#f8f8f8; }
.pc-none-text { font-size:0.78rem; color:#bbb; text-align:center; font-weight:300; line-height:1.5; }

.open-input { width:100%; background:#fff; border:1px solid rgba(42,32,24,0.15); border-radius:16px; padding:20px; color:#2a2018; font-family:'DM Sans',sans-serif; font-size:0.9rem; font-weight:300; line-height:1.7; resize:none; outline:none; transition:border-color 0.2s; min-height:140px; box-shadow:0 2px 12px rgba(42,32,24,0.06); }
.open-input:focus { border-color:#b4906a; }
.open-input::placeholder { color:#c4b4a0; }

.q-nav { padding:24px 0 40px; display:flex; justify-content:center; align-items:center; gap:12px; flex-wrap:wrap; }
.next-btn { padding:14px 40px; background:#2a2018; color:#faf7f2; border:none; border-radius:100px; font-family:'DM Sans',sans-serif; font-size:0.85rem; cursor:pointer; transition:all 0.3s; opacity:0.35; pointer-events:none; }
.next-btn.on { opacity:1; pointer-events:all; }
.next-btn.on:hover { background:#3d3020; transform:translateY(-2px); }
.back-btn { padding:14px 20px; background:transparent; border:none; color:#c4b4a0; font-family:'DM Sans',sans-serif; font-size:0.8rem; cursor:pointer; transition:all 0.2s; letter-spacing:1px; }
.back-btn:hover { color:#8a6a40; }
.skip-btn { padding:14px 24px; background:transparent; border:1px solid rgba(42,32,24,0.15); color:#9a8a70; border-radius:100px; font-family:'DM Sans',sans-serif; font-size:0.8rem; cursor:pointer; }
.skip-btn:hover { border-color:#8a6a40; }

#result { min-height:100vh; align-items:center; justify-content:center; text-align:center; padding:60px 24px; position:relative; overflow:hidden; }
#result::before { content:''; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:400px; height:400px; background:radial-gradient(circle, rgba(180,144,80,0.08) 0%, transparent 60%); pointer-events:none; }
.result-label { font-size:0.6rem; letter-spacing:5px; color:#b4906a; text-transform:uppercase; margin-bottom:20px; position:relative; z-index:1; }
.result-title { font-size:clamp(1.8rem,5vw,3rem); font-weight:300; color:#2a2018; margin-bottom:12px; position:relative; z-index:1; }
.result-sub { font-size:0.85rem; color:#b4906a; font-weight:300; font-style:italic; position:relative; z-index:1; }

@media (max-width:500px) {
  .pick-cards { grid-template-columns:1fr 1fr; }
  .demo-opts { gap:8px; }
}
</style>
</head>
<body>

<div class="progress-bar" id="progress" style="width:0%"></div>

<div class="screen active" id="intro">
  <div class="intro-eyebrow">Marka AraÅŸtÄ±rmasÄ± Â· 2026</div>
  <h1>Yeni bir marka doÄŸuyor.<br>Sen de sÃ¶z sahibisin.</h1>
  <p>Yeni bir atÄ±ÅŸtÄ±rmalÄ±k markasÄ± iÃ§in isim algÄ±sÄ± testi yapÄ±yoruz. BeÅŸ isim. Bir marka. Hangisi kazanÄ±r? 3 dakikan var.</p>
  <p style="font-size:0.75rem;color:#c4b4a0;margin-top:-24px;margin-bottom:0;">ğŸ”’ CevaplarÄ±n tamamen anonimdir.</p>
  <button class="start-btn" id="btn-start" style="margin-top:24px;">BaÅŸla â†’</button>
</div>

<div class="screen" id="survey">
  <div class="q-wrap active" id="s1">
    <div class="q-step">AdÄ±m 1 / 4</div>
    <div class="q-title">Ã–nce seni tanÄ±yalÄ±m.</div>
    <div class="q-hint">DÃ¶rt hÄ±zlÄ± soru</div>
    <div class="demo-group">
      <div class="demo-label">YaÅŸ grubu</div>
      <div class="demo-opts">
        <div class="demo-opt" data-group="age" data-val="15-24">15â€“24</div>
        <div class="demo-opt" data-group="age" data-val="25-34">25â€“34</div>
        <div class="demo-opt" data-group="age" data-val="35-44">35â€“44</div>
        <div class="demo-opt" data-group="age" data-val="45-55">45â€“55</div>
        <div class="demo-opt" data-group="age" data-val="55+">55+</div>
      </div>
    </div>
    <div class="demo-group">
      <div class="demo-label">Cinsiyet</div>
      <div class="demo-opts">
        <div class="demo-opt" data-group="gender" data-val="KadÄ±n">KadÄ±n</div>
        <div class="demo-opt" data-group="gender" data-val="Erkek">Erkek</div>
        <div class="demo-opt" data-group="gender" data-val="Belirtmek istemiyorum">Belirtmek istemiyorum</div>
      </div>
    </div>
    <div class="demo-group">
      <div class="demo-label">AlÄ±ÅŸveriÅŸ alÄ±ÅŸkanlÄ±ÄŸÄ±</div>
      <div class="demo-opts">
        <div class="demo-opt" data-group="shop" data-val="SaÄŸlÄ±klÄ± iÃ§erik">ğŸŒ¿ SaÄŸlÄ±klÄ± iÃ§erik</div>
        <div class="demo-opt" data-group="shop" data-val="Uygun fiyat">âš–ï¸ Uygun fiyat</div>
        <div class="demo-opt" data-group="shop" data-val="Yeni Ã¼rÃ¼n denerim">âœ¨ Yeni Ã¼rÃ¼n denerim</div>
        <div class="demo-opt" data-group="shop" data-val="Lezzet en Ã¶nemlisi">ğŸ˜‹ Lezzet en Ã¶nemlisi</div>
        <div class="demo-opt" data-group="shop" data-val="Marka baÄŸlÄ±lÄ±ÄŸÄ±">â¤ï¸ Marka baÄŸlÄ±lÄ±ÄŸÄ±</div>
      </div>
    </div>
    <div class="demo-group">
      <div class="demo-label">Haftada kaÃ§ kez atÄ±ÅŸtÄ±rmalÄ±k satÄ±n alÄ±rsÄ±n?</div>
      <div class="demo-opts">
        <div class="demo-opt" data-group="freq" data-val="Neredeyse hiÃ§">Neredeyse hiÃ§</div>
        <div class="demo-opt" data-group="freq" data-val="1-2 kez">1â€“2 kez</div>
        <div class="demo-opt" data-group="freq" data-val="3-4 kez">3â€“4 kez</div>
        <div class="demo-opt" data-group="freq" data-val="5+ kez">5+ kez</div>
      </div>
    </div>
    <div class="q-nav">
      <button class="back-btn" id="btn-s1-back">â† Geri</button>
      <button class="next-btn" id="btn-s1-next">Devam â†’</button>
    </div>
  </div>

  <div class="q-wrap" id="s2">
    <div class="q-step" id="s2-step">AdÄ±m 2 / 4</div>
    <div class="q-title">Bu marka sana ne hissettiriyor?</div>
    <div class="q-hint">1 = Kesinlikle katÄ±lmÄ±yorum Â· 7 = Kesinlikle katÄ±lÄ±yorum</div>
    <div class="brand-rating-page" id="rating-page"></div>
    <div class="q-nav">
      <button class="back-btn" id="btn-s2-back">â† Geri</button>
      <button class="next-btn" id="btn-s2-next">Devam â†’</button>
    </div>
  </div>

  <div class="q-wrap" id="s3">
    <div class="q-step">AdÄ±m 3 / 4</div>
    <div class="q-title">Bir isim seÃ§ecek olsan,<br>hangisini seÃ§erdin?</div>
    <div class="q-hint">Raf Ã¶nÃ¼nde duruyorsun â€” ilk iÃ§gÃ¼dÃ¼n ne?</div>
    <div class="pick-cards" id="pick-cards"></div>
    <div class="q-nav">
      <button class="back-btn" id="btn-s3-back">â† Geri</button>
      <button class="next-btn" id="btn-s3-next">Devam â†’</button>
    </div>
  </div>

  <div class="q-wrap" id="s4a">
    <div class="q-step">AdÄ±m 4 / 4</div>
    <div class="q-title">Peki sen olsan ne koyardÄ±n?</div>
    <div class="q-hint">AklÄ±na gelen her ÅŸeyi yazabilirsin</div>
    <textarea class="open-input" id="name-suggestion" placeholder="Ä°sim fikrin, beklentin, ne hissettirdi..."></textarea>
    <div class="q-nav">
      <button class="back-btn" id="btn-s4a-back">â† Geri</button>
      <button class="next-btn on" id="btn-s4a-send">GÃ¶nder â†’</button>
      <button class="skip-btn" id="btn-s4a-skip">GeÃ§</button>
    </div>
  </div>

  <div class="q-wrap" id="s4b">
    <div class="q-step">AdÄ±m 4 / 4</div>
    <div class="q-title" id="s4b-title">Bu isim sende ne Ã§aÄŸrÄ±ÅŸtÄ±rÄ±yor?</div>
    <div class="q-hint">Bir kelime bile yeter</div>
    <textarea class="open-input" id="association" placeholder="AklÄ±na ilk gelen ÅŸeyi yaz..."></textarea>
    <div class="q-nav">
      <button class="back-btn" id="btn-s4b-back">â† Geri</button>
      <button class="next-btn on" id="btn-s4b-send">GÃ¶nder â†’</button>
      <button class="skip-btn" id="btn-s4b-skip">GeÃ§</button>
    </div>
  </div>
</div>

<div class="screen" id="result">
  <div class="result-label">TeÅŸekkÃ¼rler</div>
  <div class="result-title">CevaplarÄ±n kaydedildi.</div>
  <div class="result-sub">KatkÄ±n iÃ§in teÅŸekkÃ¼rler â€” bu araÅŸtÄ±rma gerÃ§ek bir marka doÄŸuracak.</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {

  var brands = [
    { id:'NÃ–TR' }, { id:'ZENO' }, { id:'KIVO' }, { id:'MOYA' }, { id:'NUKA' }
  ];

  var criteria = [
{ id:'alÄ±rÄ±m',  emoji:'ğŸ›’', label:'Rafta gÃ¶rÃ¼rsem satÄ±n alÄ±rÄ±m' },
    { id:'premium', emoji:'âœ¨', label:'ÅÄ±k ve premium hissettiriyor' },
    { id:'merak',   emoji:'ğŸ”', label:'Merak uyandÄ±rÄ±yor, daha fazlasÄ±nÄ± gÃ¶rmek istiyorum' },
    { id:'gÃ¼ven',   emoji:'ğŸ¤', label:'GÃ¼venilir bir marka gibi duruyor' }
  ];

  var answers = { age:'', gender:'', shop:'', freq:'', ratings:{}, pick:'', association:'', nameSuggestion:'' };
  var demoFilled = { age:false, gender:false, shop:false, freq:false };
  var shuffledBrands = [];
  var ratingIdx = 0;

  function shuffle(arr) {
    var a = arr.slice();
    for (var i = a.length-1; i > 0; i--) {
      var j = Math.floor(Math.random()*(i+1));
      var t = a[i]; a[i] = a[j]; a[j] = t;
    }
    return a;
  }

  function setProgress(pct) {
    document.getElementById('progress').style.width = pct + '%';
  }

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
    document.getElementById(id).classList.add('active');
    window.scrollTo(0, 0);
  }

  function showStep(id) {
    document.querySelectorAll('.q-wrap').forEach(function(s) { s.classList.remove('active'); });
    document.getElementById(id).classList.add('active');
    window.scrollTo(0, 0);
  }

  // INTRO
  document.getElementById('btn-start').addEventListener('click', function() {
    showScreen('survey');
    setProgress(5);
  });

  // S1
  document.querySelectorAll('.demo-opt').forEach(function(el) {
    el.addEventListener('click', function() {
      var group = el.getAttribute('data-group');
      var val = el.getAttribute('data-val');
      document.querySelectorAll('.demo-opt[data-group="' + group + '"]').forEach(function(o) { o.classList.remove('sel'); });
      el.classList.add('sel');
      answers[group] = val;
      demoFilled[group] = true;
      var ok = demoFilled.age && demoFilled.gender && demoFilled.shop && demoFilled.freq;
      document.getElementById('btn-s1-next').classList.toggle('on', ok);
    });
  });

  document.getElementById('btn-s1-back').addEventListener('click', function() {
    showScreen('intro');
    setProgress(0);
  });

  document.getElementById('btn-s1-next').addEventListener('click', function() {
    if (!demoFilled.age || !demoFilled.gender || !demoFilled.shop) return;
    shuffledBrands = shuffle(brands);
    renderRating(0);
    showScreen('survey');
  });

  // S2: RATING
  function renderRating(idx) {
    ratingIdx = idx;
    var brand = shuffledBrands[idx];
    var total = shuffledBrands.length;
    document.getElementById('s2-step').textContent = 'AdÄ±m 2 / 4 â€” Marka ' + (idx+1) + ' / ' + total;

    var html = '<div class="brand-logo-box"><div class="vname">' + brand.id + '</div><div class="vsub">Smart Snacking</div></div>';
    html += '<div class="criteria-list">';
    criteria.forEach(function(c) {
      html += '<div class="criterion">';
      html += '<div class="crit-label"><span class="crit-emoji">' + c.emoji + '</span>' + c.label + '</div>';
      html += '<input class="crit-range untouched" type="range" min="1" max="7" value="1" id="range-' + c.id + '" data-crit="' + c.id + '">';
      html += '<div class="crit-nums">';
      for (var n = 1; n <= 7; n++) {
        html += '<span class="crit-num" data-crit="' + c.id + '" data-val="' + n + '">' + n + '</span>';
      }
      html += '</div>';
      html += '<div class="scale-label" id="scale-label-' + c.id + '"></div>';
      html += '</div>';
    });
    html += '</div>';
    document.getElementById('rating-page').innerHTML = html;

    criteria.forEach(function(c) {
      var inp = document.getElementById('range-' + c.id);
      inp.addEventListener('input', function() {
        inp.classList.remove('untouched');
        var v = parseInt(inp.value);
        updateCritUI(c.id, v);
        saveCrit(brand.id, c.id, v);
        checkDone();
      });
      document.querySelectorAll('.crit-num[data-crit="' + c.id + '"]').forEach(function(numEl) {
        numEl.addEventListener('click', function() {
          var v = parseInt(numEl.getAttribute('data-val'));
          inp.value = v;
          inp.classList.remove('untouched');
          updateCritUI(c.id, v);
          saveCrit(brand.id, c.id, v);
          checkDone();
        });
      });
    });

    if (answers.ratings[brand.id]) {
      criteria.forEach(function(c) {
        var v = answers.ratings[brand.id][c.id];
        if (v) {
          var inp = document.getElementById('range-' + c.id);
          if (inp) { inp.value = v; inp.classList.remove('untouched'); updateCritUI(c.id, v); }
        }
      });
    }

    checkDone();
    showStep('s2');
    setProgress(10 + idx * 14);
  }

  var scaleLabels = {
    1: 'Kesinlikle katÄ±lmÄ±yorum',
    2: 'KatÄ±lmÄ±yorum',
    3: 'Pek katÄ±lmÄ±yorum',
    4: 'KararsÄ±zÄ±m',
    5: 'Biraz katÄ±lÄ±yorum',
    6: 'KatÄ±lÄ±yorum',
    7: 'Kesinlikle katÄ±lÄ±yorum'
  };

  function updateCritUI(critId, v) {
    document.querySelectorAll('.crit-num[data-crit="' + critId + '"]').forEach(function(el) {
      el.classList.toggle('active', parseInt(el.getAttribute('data-val')) === v);
    });
    var labelEl = document.getElementById('scale-label-' + critId);
    if (labelEl) labelEl.textContent = scaleLabels[v] || '';
  }

  function saveCrit(brandId, critId, val) {
    if (!answers.ratings[brandId]) answers.ratings[brandId] = {};
    answers.ratings[brandId][critId] = val;
  }

  function checkDone() {
    var brand = shuffledBrands[ratingIdx];
    var saved = answers.ratings[brand.id] || {};
    var allDone = criteria.every(function(c) { return saved[c.id]; });
    document.getElementById('btn-s2-next').classList.toggle('on', allDone);
  }

  document.getElementById('btn-s2-back').addEventListener('click', function() {
    if (ratingIdx > 0) {
      renderRating(ratingIdx - 1);
    } else {
      showStep('s1');
      setProgress(5);
    }
  });

  document.getElementById('btn-s2-next').addEventListener('click', function() {
    if (ratingIdx < shuffledBrands.length - 1) {
      renderRating(ratingIdx + 1);
    } else {
      renderPickCards();
      showStep('s3');
      setProgress(82);
    }
  });

  // S3: PICK
  function renderPickCards() {
    var container = document.getElementById('pick-cards');
    container.innerHTML = '';
    var shuffled = shuffle(brands);
    shuffled.forEach(function(b) {
      var div = document.createElement('div');
      div.className = 'pick-card';
      div.innerHTML = '<div class="pc-visual"><div class="vname">' + b.id + '</div><div class="vsub">Smart Snacking</div></div>';
      div.addEventListener('click', function() {
        document.querySelectorAll('.pick-card').forEach(function(c) { c.classList.remove('sel'); });
        div.classList.add('sel');
        answers.pick = b.id;
        document.getElementById('btn-s3-next').classList.add('on');
      });
      container.appendChild(div);
    });
    var none = document.createElement('div');
    none.className = 'pick-card';
    none.innerHTML = '<div class="pc-none-visual"><div class="pc-none-text">HiÃ§birini<br>BeÄŸenmedim</div></div>';
    none.addEventListener('click', function() {
      document.querySelectorAll('.pick-card').forEach(function(c) { c.classList.remove('sel'); });
      none.classList.add('sel');
      answers.pick = 'none';
      document.getElementById('btn-s3-next').classList.add('on');
    });
    container.appendChild(none);
  }

  document.getElementById('btn-s3-back').addEventListener('click', function() {
    renderRating(shuffledBrands.length - 1);
  });

  document.getElementById('btn-s3-next').addEventListener('click', function() {
    if (!answers.pick) return;
    setProgress(92);
    if (answers.pick === 'none') {
      showStep('s4a');
    } else {
      document.getElementById('s4b-title').innerHTML = '<strong style="color:#b4906a">' + answers.pick + '</strong> sende ne Ã§aÄŸrÄ±ÅŸtÄ±rÄ±yor?';
      showStep('s4b');
    }
  });

  // S4a
  document.getElementById('btn-s4a-back').addEventListener('click', function() { showStep('s3'); setProgress(82); });
  document.getElementById('btn-s4a-send').addEventListener('click', submitSurvey);
  document.getElementById('btn-s4a-skip').addEventListener('click', submitSurvey);

  // S4b
  document.getElementById('btn-s4b-back').addEventListener('click', function() { showStep('s3'); setProgress(82); });
  document.getElementById('btn-s4b-send').addEventListener('click', submitSurvey);
  document.getElementById('btn-s4b-skip').addEventListener('click', submitSurvey);

  // SUBMIT
  function submitSurvey() {
    answers.association = document.getElementById('association').value || '';
    answers.nameSuggestion = document.getElementById('name-suggestion').value || '';
    setProgress(100);
    showScreen('result');

    var payload = {
      yas: answers.age,
      cinsiyet: answers.gender,
      alisveris: answers.shop,
      atiÅŸtÄ±rmalÄ±k_sÄ±klÄ±k: answers.freq,
      secilen_isim: answers.pick,
      cagrisim: answers.association,
      isim_oneri: answers.nameSuggestion,
      marka_sirasi: shuffledBrands.map(function(b) { return b.id; }).join(' â†’ ')
    };

    Object.keys(answers.ratings).forEach(function(brand) {
      Object.keys(answers.ratings[brand]).forEach(function(crit) {
        payload[brand + '_' + crit] = answers.ratings[brand][crit];
      });
    });

    fetch('https://formspree.io/f/mbdawbqv', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      body: JSON.stringify(payload)
    }).catch(function(e) { console.log('Formspree error', e); });
  }

}); // DOMContentLoaded
</script>
</body>
</html>
